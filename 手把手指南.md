這個是python django + htmx + tailwind 指南 
===
指南（二）-- 98  
指南（三）-- 652  
指南（四）-- 864  
指南（五）-- 1123  
指南（六）-- 1277  
指南（七）-- 1464  
指南（八）-- 1565  
指南（九）-- 1686  
指南（九）-- 1686  
指南（十）-- 1901  
指南（十一）-- 2099  
指南（十二）-- 2297  
指南（十三）-- 2463  
指南（十四）-- 2623  
指南（十五）-- 2859  
指南（十六）-- 3081  
指南（十七）-- 3341  
指南（十八）-- 3608  







  

[icon用](https://heroicons.com/)     
 
事前準備：  

建立一個空的資料夾 名稱自定  
如果是用workon 來開 env 請做好設定  



---  
指南(一)
要做的事：

-建立/安裝 一個 virtual environment  
-建立一個空白的django 項目  
-建立git .    

---  


一.建立一個 virtual environment
===

---
建立virtual方法不只一種  
## （指南會用方法一） 

## 方法一
1.在目前的資料夾位置打開你的終端機  （terminal）
2.在終端機（terminal）輸入    
```
mkvirtualenv tenv //這個是env的名稱
``` 
建立env成功後
<img src="指南img/workon .png">
前面會出現一個 (tenv) 這是成功

---

## 方法二  

1.在目前的資料夾位置打開你的終端機  （terminal）
2.在終端機（terminal）輸入    
```
pip3 install virtualenv
```  
3.在終端機（terminal）輸入    
```
virtualenv tenv  //這個是env的名稱
```  
成功後終端機（terminal）會出現以下的畫面
<img decoding="async" src="指南img/create virtualenv .png">
在資料夾裹多了一個tenv資枓夾
<img decoding="async" src="指南img/create tenv .png">
4. 在終端機（terminal）輸入  

*這裹注意 window系統 跟linux底系統 的路徑有不同* 
```
source tenv/bin/activate
```
成功後終端機（terminal）會出現以下的畫面
<img decoding="async" src="指南img/go in env .png">
前面會出現一個 (tenv) 這是成功  

---

安裝 django 
===
1.在終端機（terminal）輸入
```
pip install django==3.2
```
2.輸入
```
django-admin startproject Ecommerce .
```
<img src="指南img/django project .png">
多了一個Ecommerce 資料夾 和 manage.py  

---
建立git.
===

1.在終端機（terminal）裹輸入  

```
 git init 
```

2.在終端機（terminal）輸入
```
ls -la
```  
之後在終端機（terminal）裹有出現git.
<img src="指南img/git .png">  

---
指南（二）-- 98
===

要做的事：  
-建立一個App 名叫 "core"   
-建立一個基本文件 名叫 "base.html"  
-建立一個.gitignore  
-加一個頁面名叫"frontpage"并與"base.html"連結
-在"frontpage"裹加入products  

---  



建立App  
===  

1.  在終端機（terminal）輸入
```
    python manage.py startapp core
```
*注意!! 輸入這個指令前 要留意目前資料夾的位置(是否跟manage.py 同層) 及是否開了evn*  
 <img src="指南img/create app .png">

成功後 在目錄上會多了一個 core的資料夾
```
.
├── core
│   ├── admin.py
│   ├── apps.py
│   ├── __init__.py
│   ├── migrations
│   │   └── __init__.py
│   ├── models.py
│   ├── tests.py
│   └── views.py
├── Ecommerce
│   ├── asgi.py
│   ├── __init__.py
│   ├── __pycache__
│   │   ├── __init__.cpython-38.pyc
│   │   └── settings.cpython-38.pyc
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── manage.py
```

---
## 建立base.html
1. 新建一個名叫templates資料夾 在core app內,  
2. 在templates資料夾內，新建一個core的資料夾,  
3. 在core資料夾內,新建一個檔案名叫 base.html
```
── core
│   ├── admin.py
│   ├── apps.py
│   ├── __init__.py
│   ├── migrations
│   │   └── __init__.py
│   ├── models.py
│   ├── templates
│   │   └── core
│   │       └── base.html
│   ├── tests.py
│   └── views.py


```

base.html
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Document</title>
</head>
<body>
    
</body>
</html>

```
---
## 建立.gitignore  
1.在主目錄新建一個檔案名叫.gitignore

```
.
├── core
├── Ecommerce
├── manage.py
├──.gitignore

```

.gitignore
```
# Django #
*.log
*.pot
*.pyc
__pycache__
db.sqlite3
media

# Backup files # 
*.bak 

# If you are using PyCharm # 
# User-specific stuff
.idea/**/workspace.xml
.idea/**/tasks.xml
.idea/**/usage.statistics.xml
.idea/**/dictionaries
.idea/**/shelf

# AWS User-specific
.idea/**/aws.xml

# Generated files
.idea/**/contentModel.xml

# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# File-based project format
*.iws

# IntelliJ
out/

# JIRA plugin
atlassian-ide-plugin.xml

# Python # 
*.py[cod] 
*$py.class 

# Distribution / packaging 
.Python build/ 
develop-eggs/ 
dist/ 
downloads/ 
eggs/ 
.eggs/ 
lib/ 
lib64/ 
parts/ 
sdist/ 
var/ 
wheels/ 
*.egg-info/ 
.installed.cfg 
*.egg 
*.manifest 
*.spec 

# Installer logs 
pip-log.txt 
pip-delete-this-directory.txt 

# Unit test / coverage reports 
htmlcov/ 
.tox/ 
.coverage 
.coverage.* 
.cache 
.pytest_cache/ 
nosetests.xml 
coverage.xml 
*.cover 
.hypothesis/ 

# Jupyter Notebook 
.ipynb_checkpoints 

# pyenv 
.python-version 

# celery 
celerybeat-schedule.* 

# SageMath parsed files 
*.sage.py 

# Environments 
.env 
.venv 
env/ 
venv/ 
ENV/ 
env.bak/ 
venv.bak/ 

# mkdocs documentation 
/site 

# mypy 
.mypy_cache/ 

# Sublime Text # 
*.tmlanguage.cache 
*.tmPreferences.cache 
*.stTheme.cache 
*.sublime-workspace 
*.sublime-project 

# sftp configuration file 
sftp-config.json 

# Package control specific files Package 
Control.last-run 
Control.ca-list 
Control.ca-bundle 
Control.system-ca-bundle 
GitHub.sublime-settings 

# Visual Studio Code # 
.vscode/* 
!.vscode/settings.json 
!.vscode/tasks.json 
!.vscode/launch.json 
!.vscode/extensions.json 
.history

```
---
### 運行server
現在試試開著server運行  
運行前先做一些設定  

1.  打開 project Ecommerce 裹的settings.py
```
├── Ecommerce
│   ├── asgi.py
│   ├── __init__.py
│   ├── __pycache__
│   ├── settings.py  <----這個
│   ├── urls.py
│   └── wsgi.py

```
settings.py裹 在這裹 增加 App core
```
//Ecommerce/settings.py

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'core'
]
```
2. 在Ecommerce 的 urls.py 裹
```
// Ecommerce/urls.py
from django.contrib import admin
from django.urls import path ,include



urlpatterns = [
    path('', include('core.urls')),
    path('admin/', admin.site.urls),
]

```
3 . 在App core 裹新建檔案 名叫urls.py  
urls.py
```
// core/urls.py
from django.urls import path 
from .views import page

urlpatterns = [
    path('', page , name="page")

]

```
4. App core 的views.py  
views.py
```
from django.shortcuts import render

# Create your views here.

def page(request):
    return render(request, 'core/base.html')
```

5. 所有設定都完成了 可以運行server了。  
在終端機（terminal）裹
```
python manage.py runserver 8000
```
之後打開你的瀏覽器  
輸入 localhost:8000  
正常是一篇白空!!  這是成功了!!


---
## 建設base.html

base.html
```
<!doctype html>

<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.tailwindcss.com"></script>
    </head>

    <body>
        <nav class="border-b border-gray-300">
            <div class="max-w-6xl mx-auto py-2 px-6 xl:px-0 flex items-center justify-between">
                <div class="menu-left flex items-center space-x-6">
                    <a href="#" class="py-4 text-lg text-purple-500 font-semibold">Ecommerce</a>

                    <ul class="flex items-center space-x-4">
                        <li><a href="#">商店</a></li>
                        <li><a href="#">關於</a></li>
                    </ul>
                </div>

                <div class="menu-right flex items-center space-x-4">
                    <a href="#">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </a>

                    <a href="#">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                    </a>
                </div>
            </div>
        </nav>
        <header class="px-6 py-10 lg:py-20 bg-purple-500">
            <div class="max-w-3xl mx-auto text-center">
                <p class="mb-2 text-3xl lg:text-5xl text-white">Welcome to Ecommerce</p>
        
                <p class="mb-10 text-white">Ecommerce</p>
        
                <a href="#" class="inline-block px-8 py-4 rounded-xl bg-white text-purple-500 hover:bg-gray-200">Start shopping</a>
            </div>
        </header>

        <footer class="bg-gray-100">
            <div class="max-w-6xl mx-auto py-10 px-6 xl:px-0 md:flex justify-between">
                <div class="footer-left mb-12 md:mb-0">
                    <h2 class="mb-5 uppercase text-lg">關於我們</h2>

                    <p class="text-gray-700">是但</p>
                </div>

                <div class="footer-right">
                    <h2 class="mb-5 uppercase text-lg">聯絡</h2>

                    <ul class="space-y-2">
                        <li><a href="#" class="text-purple-500 hover:text-purple-800">Facebook</a></li>
                        <li><a href="#" class="text-purple-500 hover:text-purple-800">Twitter</a></li>
                        <li><a href="#" class="text-purple-500 hover:text-purple-800">Instagram</a></li>
                    </ul>
                </div>
            </div>
        </footer>
    </body>
</html>
```

## 建立frontpage頁面

1.在App core 裹  

/templates/core 這裹新建檔案名叫 frontpage.html  
frontpage.html

```
{% extends 'core/base.html' %}
{% block content %}
<header class="px-6 py-10 lg:py-20 bg-purple-500">
    <div class="max-w-3xl mx-auto text-center">
        <p class="mb-2 text-3xl lg:text-5xl text-white">Welcome to Ecommerce</p>

        <p class="mb-10 text-white">Ecommerce</p>

        <a href="#" class="inline-block px-8 py-4 rounded-xl bg-white text-purple-500 hover:bg-gray-200">Start shopping</a>
    </div>
</header>
{% endblock %}
```

base.html  
```
// header 位置變成這樣
        {% block content %}
        {% endblock %}
```
在App core  
core/views.py
```
from django.shortcuts import render

# Create your views here.

def frontpage(request):
    return render(request, 'core/frontpage.html') 
```

core/urls.py
```
from django.urls import path 
from .views import frontpage

urlpatterns = [
    path('', frontpage , name="page")

]

```
---
## 加入products
frontpage.html
```
{% extends 'core/base.html' %}
{% block content %}
<header class="px-6 py-10 lg:py-20 bg-purple-500">
    <div class="max-w-3xl mx-auto text-center">
        <p class="mb-2 text-3xl lg:text-5xl text-white">Welcome to Ecommerce</p>

        <p class="mb-10 text-white">Ecommerce</p>

        <a href="#" class="inline-block px-8 py-4 rounded-xl bg-white text-purple-500 hover:bg-gray-200">Start shopping</a>
    </div>
</header>
<div class="max-w-6xl mx-auto py-2 px-6 xl:px-0">
    <div class="products flex items-center flex-wrap">
        <div class="w-full md:w-1/3 xl:w-1/4 p-6">
            <a href="#">
                <img class="rounded-xl hover:shadow-lg">
            </a>

            <div class="pt-3 flex items-center justify-between">
                <a href="#">Product name</a>

                <a href="#" class="text-purple-500 hover:text-purple-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                </a>
            </div>

            <p class="pt-1 text-gray-400">$9.99</p>
        </div>

        <div class="w-full md:w-1/3 xl:w-1/4 p-6">
            <a href="#">
                <img class="rounded-xl hover:shadow-lg">
            </a>

            <div class="pt-3 flex items-center justify-between">
                <a href="#">Product name</a>

                <a href="#" class="text-purple-500 hover:text-purple-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                </a>
            </div>

            <p class="pt-1 text-gray-400">$9.99</p>
        </div>
        
        <div class="w-full md:w-1/3 xl:w-1/4 p-6">
            <a href="#">
                <img class="rounded-xl hover:shadow-lg">
            </a>

            <div class="pt-3 flex items-center justify-between">
                <a href="#">Product name</a>

                <a href="#" class="text-purple-500 hover:text-purple-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                </a>
            </div>

            <p class="pt-1 text-gray-400">$9.99</p>
        </div>

        <div class="w-full md:w-1/3 xl:w-1/4 p-6">
            <a href="#">
                <img class="rounded-xl hover:shadow-lg">
            </a>

            <div class="pt-3 flex items-center justify-between">
                <a href="#">Product name</a>

                <a href="#" class="text-purple-500 hover:text-purple-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                </a>
            </div>

            <p class="pt-1 text-gray-400">$9.99</p>
        </div>

        <div class="w-full md:w-1/3 xl:w-1/4 p-6">
            <a href="#">
                <img class="rounded-xl hover:shadow-lg">
            </a>

            <div class="pt-3 flex items-center justify-between">
                <a href="#">Product name</a>

                <a href="#" class="text-purple-500 hover:text-purple-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                </a>
            </div>

            <p class="pt-1 text-gray-400">$9.99</p>
        </div>
    </div>
</div>
{% endblock %}
```
---
指南（三）-- 652
===

要做的事：  
-建立一個App 名叫 product  
-建立一個 category database 模組  
-加入categories 在 admin 界面  
-建立一個 products database 模組  
-加入products 在 admin 界面  
-在front page 頁面 顯示 products

---

## 建立product App
1. 在終端機（terminal）裹  
```
python manage.py startapp product
```
```
.
├── core
├── db.sqlite3
├── Ecommerce
├── manage.py
├── product
```
---
## 建立category database 模組  
 1. product/models.py
 ```
 class Category(models.Model):
    name = models.CharField(max_length=255)
    slug = models.SlugField()

    class Meta:
        ordering = ('name',)
    
    def __str__(self):
        return self.name
 ```

---
## 加入categories 在 admin 界面  
1. product/admin.py
```
from django.contrib import admin

# Register your models here.

from .models import Category

admin.site.register(Category)
```
2. Ecommerce/settings.py
```
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'core',
    'product', //加入product
]

```
3. 在終端機（terminal）裹   

```
python manage.py makemigrations

python manage.py migrate
```  

4. 完成第2步後，開始建立超級用戶  
在終端機（terminal）裹 
```
python manage.py createsuperuser
```
```
Username (leave blank to use 'user'): admin //輸入用戶名稱
Email address:  //可以留空白
Password:   //6個字以上
Password (again): //跟Password一樣
```
完成後 會出一句  
 Superuser created successfully.   
 就是成功  

---

### 之後試運行server , 去localhost:8000/admin
<img src="指南img/admin page .png">
登入
<img src="指南img/登入admin.png">  
按add  
<img src="指南img/加入類型 .png">
在此加入類別 之後按save  
(因個人喜好加入類別數量)

---  
## 建立Product database model  
1.product/models  
```
from django.db import models

# Create your models here.

class Category(models.Model):
    name = models.CharField(max_length=255)
    slug = models.SlugField()

    class Meta:
        ordering = ('name',)
    
    def __str__(self):
        return self.name

 //加入product model
class Product(models.Model):
    category = models.ForeignKey(Category, related_name='products', on_delete=models.CASCADE)
    name = models.CharField(max_length=255)
    slug = models.SlugField()
    description = models.TextField(blank=True, null=True)
    price = models.IntegerField()
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ('-created_at',)
    
    def __str__(self):
        return self.name
```
---
## 加入products 在 admin 界面
1. product/admin.py
```
from django.contrib import admin

# Register your models here.
//加入 Product

from .models import Category, Product

admin.site.register(Category)
admin.site.register(Product)
```
2. 在終端機（terminal）裹   
```
python manage.py makemigrations

python manage.py migrate
```
之後再返回localhost:8000/admin
<img src="指南img/多了products .png">
多了products

---
## 在front page 頁面 顯示 products
在localhost:8000/admin
1. prodoucts行按add 
2. (因個人喜好加入商品數量)  


3. core/view.py
```
from django.shortcuts import render

from product.models import Product  //import Product DB
# Create your views here.

def frontpage(request):
    products = Product.objects.all()[0:8] // 用 Product DB
    return render(request, 'core/frontpage.html', {'products': products}) 
    //把DB內容傳入template
```

4. core/templates/core/frontpage.html
```
{% extends 'core/base.html' %}
{% block content %}
...

<div class="max-w-6xl mx-auto py-2 px-6 xl:px-0">
    <div class="products flex items-center flex-wrap">
        {% for product in products %}
            <div class="w-full md:w-1/3 xl:w-1/4 p-6">
                <a href="#">
                    <img class="rounded-xl hover:shadow-lg">
                </a>

                <div class="pt-3 flex items-center justify-between">
                    <a href="#">{{ product.name }}</a>

                    <a href="#" class="text-purple-500 hover:text-purple-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                    </a>
                </div>

                <p class="pt-1 text-gray-400">$9.99</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
```
---
指南（四）-- 862
===
要做的事：  
-建立 category/shop html頁面  
-建立 product內容 html頁面

---
## 建立 category/shop html頁面 
1. core/views.py 
```
...
//加入shop page function
def shop(request):
    products = Product.objects.all()

    return render(request, 'core/shop.html', {'products': products})
```
2. 在core/templates/core新建shop.html的檔案  
shop.html
```
{% extends 'core/base.html' %}

{% block content %}

<div class="max-w-6xl mx-auto py-2 px-6 xl:px-0">
    <div class="products flex items-center flex-wrap">
        {% for product in products %}
            <div class="w-full md:w-1/3 xl:w-1/4 p-6">
                <a href="#">
                    <img class="rounded-xl hover:shadow-lg">
                </a>

                <div class="pt-3 flex items-center justify-between">
                    <a href="#">{{ product.name }}</a>

                    <a href="#" class="text-purple-500 hover:text-purple-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                    </a>
                </div>

                <p class="pt-1 text-gray-400">$9.99</p>
            </div>
        {% endfor %}
    </div>

{% endblock %}
```
3. 在Ecommerce/urls.py   
```
from django.contrib import admin
from django.urls import path ,include
from core.views import shop <---加入 core/views.py 裹 shop function

urlpatterns = [
    path('', include('core.urls')),
    path('shop/', shop ,name="shop"), <-- 建立shop 的url /api
    path('admin/', admin.site.urls),
]


```
4. core/templates/core/base.html

```
...
                    <ul class="flex items-center space-x-4">
                        <li><a href="{% url 'shop' %}">商店</a></li> <--這裹的#改掉
                        <li><a href="#">關於</a></li>
                    </ul>
                </div>
...
```
加入一個搜索位
5. core/templates/core/shop.html  
shop.html
```
<div class="max-w-6xl mx-auto flex flex-wrap items-start py-6 px-6 xl:px-0"> <--多了flex flex-wrap 
    <div class="filters w-full lg:w-1/4">
        <h3 class="mb-3 text-xl uppercase">Search</h3>

        <form>
            <div class="flex">
                <input type="text" class="p-4 bg-gray-100 border-0" placeholder="Search...">

                <button class="p-4 bg-gray-100 border-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
            </div>
        </form>
    </div>
    <div class="products w-full lg:w-3/4 flex items-center flex-wrap">  <-- w-full lg:w-3/4
 ...

```
之後再加多一個類別位
6. 都是在core/templates/core/shop.html  
shop.html
```
...
    <div class="filters w-full lg:w-1/4">
        <h3 class="mb-3 text-xl uppercase">Search</h3>

        <form>
            <div class="flex">
                <input type="text" class="p-4 bg-gray-100 border-0" placeholder="Search...">

                <button class="p-4 bg-gray-100 border-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
            </div>
        </form>

//多了這個
        <h3 class="mt-6 mb-3 text-xl uppercase">Categories</h3>

        <ul class="space-y-2">
            <li><a href="#" class="text-purple-500">All categories</a></li>
            <li><a href="#" class="text-gray-500">名</a></li>
            <li><a href="#" class="text-gray-500">名</a></li>
            <li><a href="#" class="text-gray-500">名</a></li>
        </ul>
//直到這
    </div>
...

```

整個 shop.html 

```
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto flex flex-wrap items-start py-6 px-6 xl:px-0"> <---有小改
    <div class="filters w-full lg:w-1/4">
        <h3 class="mb-3 text-xl uppercase">Search</h3>

        <form>
            <div class="flex">
                <input type="text" class="p-4 bg-gray-100 border-0" placeholder="Search...">

                <button class="p-4 bg-gray-100 border-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
            </div>
        </form>

        <h3 class="mt-6 mb-3 text-xl uppercase">Categories</h3>

        <ul class="space-y-2">
            <li><a href="#" class="text-purple-500">All categories</a></li>
            <li><a href="#" class="text-gray-500">名</a></li>
            <li><a href="#" class="text-gray-500">名</a></li>
            <li><a href="#" class="text-gray-500">名</a></li>
        </ul>
    </div>

    <div class="products w-full lg:w-3/4 -mt-4 flex items-center flex-wrap">
        {% for product in products %}
            <div class="w-full md:w-1/3 xl:w-1/4 p-6">
                <a href="#">
                    <img class="rounded-xl hover:shadow-lg">
                </a>

                <div class="pt-3 flex items-center justify-between">
                    <a href="#">{{ product.name }}</a>

                    <a href="#" class="text-purple-500 hover:text-purple-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                    </a>
                </div>

                <p class="pt-1 text-gray-400">$9.99</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

```
---
## 建立 product內容 html頁面
1. 在App product 裹
開一個templates資料夾，templates資料夾裹面再開一個product資料夾,
最後在product資料夾裹,開product.html
```
├── product
│   ├── admin.py
│   ├── apps.py
│   ├── __init__.py
│   ├── migrations
│   ├── models.py
│   ├── __pycache__
│   ├── templates
│   │   └── product
│   │       └── product.html
│   ├── tests.py
│   └── views.py

```  
product.html
```
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto flex flex-wrap py-6 px-6 xl:px-0">
    <div class="images w-full mb-6 lg:mb-0 lg:w-3/5">
        <img class="rounded-xl" src="1.jpg">
    </div>

    <div class="information w-full lg:w-2/5 lg:p-6">
        <h1 class="text-2xl">Product Name</h1>

        <p class="mt-1 text-gray-400">$9.99</p>

        <p class="mt-6 text-gray-700">Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet.</p>

        <a href="#" class="mt-6 inline-block px-8 py-4 rounded-xl bg-purple-500 text-white hover:bg-purple-700">
            Add to cart
        </a>
    </div>
</div>
{% endblock %}
```  
2. product/views.py
```
from django.shortcuts import render

def product(request):
    return render(request, 'product/product.html')
```
3. Ecommerce/urls.py
```
from core.views import shop
from product.views import product <--引入product


urlpatterns = [
    path('', include('core.urls')),
    path('shop/', shop ,name="shop"),
    path('product/', product , name="product"), <--加入product url/api
    path('admin/', admin.site.urls),
]


```
---
指南（五）-- 1123
===
耍做的事：  
-在側欄顯示類別  
-顯示類別內容  
-簡單搜索商品功能  

---
## 在側欄顯示類別 
1. core/views.py  
views.py  
```
...

from product.models import Product, Category <-- 加入Category models

...

def shop(request):
    categories = Category.objects.all() <-- 用Category DB
    products = Product.objects.all()

    context = {
        'categories':categories,
        'products':products,
    } //用context 包著以上資料

    return render(request, 'core/shop.html', context) //用context傳入template
```
2. core/templates/core/shop.html  
shop.html  
```
...
    //Categoy 有修改
        <h3 class="mt-6 mb-3 text-xl uppercase">Categories</h3>

        <ul class="space-y-2">
            <li><a href="{% url 'shop' %}" class="text-purple-500">All categories</a></li>
            {% for category in categories %}
            <li><a href="{% url 'shop' %}?category={{category.slug}}" class="text-gray-500">{{ category.name }}</a></li>
            {% endfor %}
        </ul>
...

```

---
## 顯示類別內容 
1. core/views.py
```
... 

def shop(request):
    categories = Category.objects.all()
    products = Product.objects.all()

    active_category = request.GET.get('category', '') <-- 拿url 裹的params

    context = {
        'categories':categories,
        'products':products,
        'active_category': active_category <-- 放入context
    }

    return render(request, 'core/shop.html', context)
```
2. core/templates/core/shop.html
```
...
        <ul class="space-y-2">
            <li><a href="{% url 'shop' %}" class="{% if not active_category %}text-purple-500{% else %}text-gray-500{% endif %}">All categories</a></li> //加入 active_category 判別

            {% for category in categories %}
                <li><a href="{% url 'shop' %}?category={{ category.slug }}" class="{% if category.slug == active_category %}text-purple-500{% else %}text-gray-500{% endif %}">{{ category.name }}</a></li>
                //加入 active_category 判別
            {% endfor %}
...
```
這就可以用傾欄自由轉換頁面
3. 最後在core/views.py
```
...
def shop(request):
    categories = Category.objects.all()
    products = Product.objects.all()

    active_category = request.GET.get('category', '')

    if active_category: 
        products = products.filter(category__slug=active_category) //加入 active_category 判別

    context = {
        'categories':categories,
        'products':products,
        'active_category': active_category
    }

    return render(request, 'core/shop.html', context)

```

---
## 簡單搜索商品功能
1. core/templates/core/shop.html
```
        ...
        <form method="get" action="."> //加入 method action
            <div class="flex">
                <input type="text" name="query" class="p-4 bg-gray-100 border-0" placeholder="Search..."> //加入name

                <button class="p-4 bg-gray-100 border-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
            </div>
        </form>
        ...
```
2. core/views.py
```
from django.shortcuts import render
from django.db.models import Q  //加入
from product.models import Product, Category
# Create your views here.

def frontpage(request):
    products = Product.objects.all()[0:8]
    return render(request, 'core/frontpage.html', {'products': products})

def shop(request):
    categories = Category.objects.all()
    products = Product.objects.all()

    active_category = request.GET.get('category', '')

    if active_category:
        products = products.filter(category__slug=active_category)

    query = request.GET.get('query', '') //拿url 的query

    if query: // query 判別
        products = products.filter(Q(name__icontains=query) | Q(description__icontains=query))


    context = {
        'categories':categories,
        'products':products,
        'active_category': active_category
    }

    return render(request, 'core/shop.html', context)
```
---
指南（六）-- 1277
===
要做的事：  
-價錢修改  
-navbar  
-顯示產品詳細頁面

---
## 價錢修改  
1. product/models.py
```
...
class Product(models.Model):
    category = models.ForeignKey(Category, related_name='products', on_delete=models.CASCADE)
    name = models.CharField(max_length=255)
    slug = models.SlugField()
    description = models.TextField(blank=True, null=True)
    price = models.IntegerField()
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ('-created_at',)
    
    def __str__(self):
        return self.name

    def get_display_price(self): //加入get_display_price function
        return self.price / 100

```
2. core/templates/core/shop.html
```
    ...
    <p class="pt-1 text-gray-400">${{ product.get_display_price }}</p> //把價錢改成 product db 的 get_display_price
    ...
```

---
## 可重複使用產品列表

1. core/templates/core/frontpage.html
```
...
<div class="max-w-6xl mx-auto py-2 px-6 xl:px-0">
    <div class="products flex items-center flex-wrap">
        {% for product in products %}
            {% include 'product/partials/product_list_item.html' %} //include product_list_item.html
        {% endfor %}
    </div>
</div>
...

```
2. core/templates/core/shop.html
```
...
    <div class="products w-full lg:w-3/4 -mt-4 flex items-center flex-wrap">
        {% for product in products %}
            {% include 'product/partials/product_list_item.html' %}
        {% endfor %}
    </div>
...
```


3. 在product/templates/product裹建立parttials資料夾，parttials資料夾裹建立product_list_item.html  
```
├── product
│   ├── admin.py
│   ├── apps.py
│   ├── __init__.py
│   ├── migrations
│   ├── models.py
│   ├── __pycache__
│   ├── templates
│   │   └── product
│   │       ├── partials
│   │       │   └── product_list_item.html
│   │       └── product.html
│   ├── tests.py
│   └── views.py


```

4. product/templates/product/partials/product_list_item.html
```
<div class="w-full md:w-1/3 xl:w-1/4 p-6">
    <a href="#">
        <img class="rounded-xl hover:shadow-lg">
    </a>

    <div class="pt-3 flex items-center justify-between">
        <a href="#">{{ product.name }}</a>

        <a href="#" class="text-purple-500 hover:text-purple-800">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
            </svg>
        </a>
    </div>

    <p class="pt-1 text-gray-400">${{ product.get_display_price }}</p>
</div>
```

5. core/templates/core/base.html
```
                ...
                    <a href="{% url 'page' %}" class="py-4 text-lg text-purple-500 font-semibold">Ecommerce</a> //把# 改成 {% url 'page' %}
                ...
```
---
## 顯示產品詳細頁面
1. product/templates/product/partials/product_list_item.html
```
<div class="w-full md:w-1/3 xl:w-1/4 p-6">
    <a href="{% url 'product' product.slug %}">  //把# 改成 {% url 'product' product.slug %}
        <img class="rounded-xl hover:shadow-lg">
    </a>

    <div class="pt-3 flex items-center justify-between">
        <a href="{% url 'product' product.slug %}">{{ product.name }}</a>
         //把# 改成 {% url 'product' product.slug %}

        <a href="{% url 'product' product.slug %}" class="text-purple-500 hover:text-purple-800">
        //把# 改成 {% url 'product' product.slug %}

            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
            </svg>
        </a>
    </div>

    <p class="pt-1 text-gray-400">${{ product.get_display_price }}</p>
</div>
```
2. Ecommerce/urls.py  
```
urlpatterns = [
    path('', include('core.urls')),
    path('shop/', shop ,name="shop"),
    path('shop/<slug:slug>', product , name="product"), // 改了 url /api
    path('admin/', admin.site.urls),
]

```
3. product/views.py  
```
from django.shortcuts import render, get_object_or_404 //增加 get_object_or_404

from .models import Product // 引入Product models

def product(request, slug ): //新增slug 函數
    product = get_object_or_404(Product, slug=slug) // 有就出data 無就出404
    return render(request, 'product/product.html',{'product': product}) //傳入template

```
4. product/templates/product/product.html  
```
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto flex flex-wrap py-6 px-6 xl:px-0">
    <div class="images w-full mb-6 lg:mb-0 lg:w-3/5">
        <img class="rounded-xl" src="1.jpg">
    </div>

    <div class="information w-full lg:w-2/5 lg:p-6">
        <h1 class="text-2xl">{{ product.name }}</h1>

        <p class="mt-1 text-gray-400">${{ product.get_display_price }}</p>

        {% if product.description %}
        <p class="mt-6 text-gray-700">{{ product.description }}</p>
        {% endif %}

        <a href="#" class="mt-6 inline-block px-8 py-4 rounded-xl bg-purple-500 text-white hover:bg-purple-700">
            Add to cart
        </a>
    </div>
</div>
{% endblock %}
```
---
指南（七）-- 1464  
---  
要做的事： 
-建立名叫cart 的 App  
-建立叫 cart 的class  
-把 cart 全局化  

---
##  建立名叫cart 的 App
1. 在終端機（terminal）輸入
```
python manage.py startapp cart
```
```
.
├── cart
├── core
├── db.sqlite3
├── Ecommerce
├── manage.py
├── product
```
2. Ecommerce/settings.py
```
SESSION_COOKIE_AGE = 86400  <--加入cookie 時間
CART_SESSION_ID = 'cart' <-- session id 名

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'cart', <--註冊cart 
    'core',
    'product',
]
```
---
##  建立叫 cart 的class
1. 在cart裹建立一個名叫 cart.py
```
from django.conf import settings <--拉入settings

from product.models import Product <-- 拉入product DB

class Cart(object):
    def __init__(self, request):
        self.session = request.session 
        cart = self.session.get(settings.CART_SESSION_ID) 
        //拿settings裹的CART_SESSION_ID

        if not cart:
            cart = self.session[settings.CART_SESSION_ID] = {}
        
        self.cart = cart
    
    def __iter__(self): // Product DB的資枓放進 session cart
        for p in self.cart.keys():
            self.cart[str(p)]['product'] = Product.objects.get(pk=p)
    
    def __len__(self): //減量
        return sum(item['quantity'] for item in self.cart.values())
    
    def save(self): // 儲存
        self.session[settings.CART_SESSION_ID] = self.cart
        self.session.modified = True
    
    def add(self, product_id, quantity=1, update_quantity=False):
     //加量 / 0 =》1
        product_id = str(product_id)

        if product_id not in self.cart:
            self.cart[product_id] = {'quantity': 1, 'id': product_id}
        
        if update_quantity:
            self.cart[product_id]['quantity'] += int(quantity)

            if self.cart[product_id]['quantity'] == 0:
                self.remove(product_id)
            
        self.save()
    
    def remove(self, product_id): // 刪除
        if product_id in self.cart:
            del self.cart[product_id]
            self.save()

```
---
##  把 cart 全局化
1. 在cart裹創建context_processors.py
```
from .cart import Cart

def cart(request):
    return {'cart': Cart(request)}
```
---
指南（八）-- 1565
要做的事：  
-建立一個購物車的頁面  
-導入 htmx cdn  
<!-- <script src="https://unpkg.com/htmx.org@1.7.0"></script>   -->
-在 nav bar 加入 cart html  
-加入購物車

---
## 建立一個購物車的頁面 
1. cart/views.py
```
from .cart import Cart <-- 引入cart.py裹的Cart class

def add_to_cart(request, product_id):
    cart = Cart(request)
    cart.add(product_id)

    return render(request, 'cart/menu_cart.html')
```
2. 在cart App裹新建 templates資料夾，裹面新創cart資料夾，裹面創立 menu_cart.html
menu_cart.html
```
<a href="#" id="menu-cart-button" class="relative">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
    </svg>

    <span class="p-2 absolute -top-4 -right-3 bg-indigo-500 text-white text-xs rounded-full">{{ cart|length }}</span>
</a>
```
3. Ecommerce/urls.py
```
...
from cart.views import add_to_cart <-- 加入 頁面 function
...
urlpatterns = [
    ...
    path('add_to_cart/<int:product_id>/',add_to_cart, <--加入API /URL
    ...
]

```
---
## 導入 htmx cdn 
1.  core/templates/base.html
```
...
<script src="https://unpkg.com/htmx.org@1.7.0"></script> <-- 加入htmx cdn

```
2. Ecommerce/settings (上一集留了)
```
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                'cart.context_processors.cart', <-- 加入這個
            ],
        },
    },
]

```


---
## 在 nav bar 加入 cart html
1. core/templates/base.html
```
...

                <div class="menu-right flex items-center space-x-4">
                    <a href="#">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </a>

                    {% include 'cart/menu_cart.html' %} <-- 改成 引導html
                </div>
            </div>
        </nav>
        {% block content %}
        {% endblock %}

...

```
---
## 加入購物車
1. product/template/product/product.html
```
...
        {% if product.description %}
        <p class="mt-6 text-gray-700">{{ product.description }}</p>
        {% endif %}
        <a 
            href="#" 
            class="mt-6 inline-block px-8 py-4 rounded-xl bg-purple-500 text-white hover:bg-purple-700"
            hx-get="{% url 'add_to_cart' product.id %}" <-- 加了hx-get 是指 url 
            hx-target="#menu-cart-button" <-- 是指cart/templates/cart/menu_cart.html 內的id
            hx-swap="outerHTML" <-- 轉為HTML 
        >
            Add to cart
        </a>

...

```

---
指南（九）-- 1686
===
要做的事：  
-建立註冊頁面 和 登入頁面  
-加入商品圖片  

---
## 建立註冊頁面 和 登入頁面 
 1. core/views.py  
 ```
...

def signup(request): 
    return render(request, 'core/signup.html') //加入註冊頁面

def login(request):
    return render(request, 'core/login.html') //加入登入頁面
 
...

 ```
2. 在core/templates/core裹分別新創 signup.html 和 login.html  

signup.html  
```
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-lg mx-auto flex flex-wrap p-6">
    <div class="w-full bg-gray-100 p-6 rounded-xl">
        <h1 class="mb-6 text-2xl">Sign up</h1>

        <form method="post" action="." class="space-y-3">
            <div>
                <label>E-mail</label>
                <input type="email" class="w-full mt-2 py-4 px-6 bg-white rounded-xl">
            </div>

            <div>
                <label>Password</label>
                <input type="password" class="w-full mt-2 py-4 px-6 bg-white rounded-xl">
            </div>

            <div>
                <label>Repeat pasword</label>
                <input type="password" class="w-full mt-2 py-4 px-6 bg-white rounded-xl">
            </div>

            <div class="p-6 bg-red-200 text-red-800 rounded-xl">
                <p>This is an error!</p>
            </div>

            <div>
                <button class="py-4 px-6 rounded-xl text-white bg-purple-500 hover:bg-purple-700">Submit</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
```
login.html  
```

 

{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-lg mx-auto flex flex-wrap p-6">
    <div class="w-full bg-gray-100 p-6 rounded-xl">
        <h1 class="mb-6 text-2xl">Log in</h1>

        <form method="post" action="." class="space-y-3">
            <div>
                <label>E-mail</label>
                <input type="email" class="w-full mt-2 py-4 px-6 bg-white rounded-xl">
            </div>

            <div>
                <label>Password</label>
                <input type="password" class="w-full mt-2 py-4 px-6 bg-white rounded-xl">
            </div>

            <div class="p-6 bg-red-200 text-red-800 rounded-xl">
                <p>This is an error!</p>
            </div>

            <div>
                <button class="py-4 px-6 rounded-xl text-white bg-purple-500 hover:bg-purple-700">Submit</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
```
3. Ecommerce/urls.py  
```
...
from core.views import frontpage, shop, signup, login <-- 加入signup login function

urlpatterns = [
...
path('signup/',signup, name='signup'),
path('login/',login,name='login'),
// 分別加入 signup 和 login url/api
...
]

```

---
## 加入商品圖片  
1. Ecommerce/settings.py
```
...
STATIC_URL = '/static/'
MEDIA_URL = '/media/' //加入MEDIA url
MEDIA_ROOT = BASE_DIR / 'media/' //定義MEDIA 位置
...

```
2. Ecommerce/urls.py
```
from django.conf import settings //引入settings
from django.conf.urls.static import static //引入static
...

urlpatterns=[
    ...
]+ static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
//加了這句 DJANGO會幫你生成MEDIA資料夾 你的圖會在MEDIA資料夾出現

```
3. product/models.py
```
...
class Product(models.Model):
    category = models.ForeignKey(Category, related_name='products', on_delete=models.CASCADE)
    name = models.CharField(max_length=255)
    slug = models.SlugField()
    description = models.TextField(blank=True, null=True)
    price = models.IntegerField()
    created_at = models.DateTimeField(auto_now_add=True)
    image = models.ImageField(upload_to='uploads/', blank=True, null=True) <-- 加入image field
    thumbnail = models.ImageField(upload_to='uploads/', blank=True, null=True) <-- 加入 thumbnail field
...

```
之後在終端機應該會有error出現 大概意思是Pillow的問題
4. 在終端機裹  
```
pip install pillow
python manage.py makemigrations
python manage.py migrate
```
5. product/models.py
```
from django.core.files import File
from io import BytesIO
from PIL import Image

...


    def get_thumbnail(self):
        if self.thumbnail:
            return self.thumbnail.url
        else:
            if self.image:
                self.thumbnail = self.make_thumbnail(self.image)
                self.save()

                return self.thumbnail.url
            else:
                return '' //一張error圖

    def make_thumbnail(self, image, size=(300, 300)):
        img = Image.open(image)
        img.convert('RGB')
        img.thumbnail(size)

        thumb_io = BytesIO()
        img.save(thumb_io, 'JPEG', quality=85)

        thumbnail = File(thumb_io, name=image.name)

        return thumbnail


```
6. product/templates/product/partials/product_list_item.html
```
...
    <a href="{% url 'product' product.slug %}">
        <img src="{{ product.get_thumbnail }}"  class="rounded-xl hover:shadow-lg"> <-- 在src 加入product DB裹的get_thumbnail
    </a>

...


```

7. roduct/templates/product.html
```
...
    <div class="images w-full mb-6 lg:mb-0 lg:w-3/5">
        <img  class="rounded-xl" src="{{ product.get_thumbnail }}">
    </div> <-- 在src 加入product DB裹的get_thumbnail
...

```

---
指南（十）--1901
===
要做的事：
- login 功能  
- signup 功能
- logout 功能

---
## signup 功能  
1. 在 core App裹開一個forms.py

core/forms.py
```
from django import forms  <-- 引用forms
from django.contrib.auth.forms import UserCreationForm <-- 用forms裹面的UserCreationForm
from django.contrib.auth.models import User <-- 用django內置的auth 的User models

class SignUpForm(UserCreationForm): <--設定Form的內容
    username = forms.CharField(max_length=50, required=True) 
    email = forms.EmailField(max_length=255, required=True)

    class Meta: <--傳入DB
        model = User
        fields = ['username', 'email', 'password1', 'password2',]
```
2. core/views.py
```
from django.shortcuts import render , redirect  <-- 加入redirect
from django.db.models import Q
from product.models import Product, Category
from django.contrib.auth import login <-- 在django內拿login function 用
from .forms import SignUpForm <-- 引導forms.py 內 SignUpForm 用

...

def signup(request):
    if request.method == 'POST': <--方法是Post
        form = SignUpForm(request.POST) <--那個form 是post

        if form.is_valid(): <-- 如果沒錯
            user = form.save() <-- 就會save

            login(request, user) <-- 是把這些資料用作login用

            return redirect('/') <-- 反回 主頁
    else:
        form = SignUpForm()   
    return render(request, 'core/signup.html', {'form': form}) <-- 有錯就返回signup.html

    return render(request, 'core/signup.html')

def login_old(request): <-- 撞了名 後加_old
    return render(request, 'core/login.html')


....

```
3. core/templates/core/signup.html
```
        <form method="post" action="." class="space-y-3">
            {% csrf_token %} <-- 加入csrf_ token
            <div>
                <label>用戶</label>
                <input type="text" name="username" class="w-full mt-2 py-4 px-6 bg-white rounded-xl"> <--新開多一個input 叫username 
            </div>

            <div>
                <label>電子郵件</label>
                <input type="email" name="email" class="w-full mt-2 py-4 px-6 bg-white rounded-xl">
            </div> <--加name

            <div>
                <label>密碼</label>
                <input type="password" name="password1" class="w-full mt-2 py-4 px-6 bg-white rounded-xl"> <--加name
            </div>

            <div>
                <label>重復密碼</label>
                <input type="password" name="password2" class="w-full mt-2 py-4 px-6 bg-white rou不nded-xl"> <--加name
            </div>

    // 顥示error 判定
            {% if form.errors %}
                {% for field in form %}
                    {% for error in field.errors %}
                        <div class="p-6 bg-red-200 text-red-800 rounded-xl">
                            <p>{{ error|escape }}</p>
                        </div>
                    {% endfor %}
                {% endfor %}

                {% for error in form.non_field_errors %}
                    <div class="p-6 bg-red-200 text-red-800 rounded-xl">
                        <p>{{ error|escape }}</p>
                    </div>
                {% endfor %}
            {% endif %}


```
4. Ecommerce/urls.py
```
...
    from core.views import shop , signup , login_old <-- 改了login_old
...

    path('login/', login_old, name='login'),<-- 改了login_old
...
```

---
## logout 功能
1. Ecommerce/urls.py
```
...
from django.contrib.auth import views
...

path('logout/', views.LogoutView.as_view(), name='logout'), <-- 用views內的logout function
...
```
2. core/templates/core/base.html
```
...
                    <ul class="flex items-center space-x-4">
                        <li><a href="{% url 'shop' %}">shop</a></li>
                        <li><a href="#">About</a></li>

                        {% if request.user.is_authenticated %} <--加入logout 判斷
                        <li><a href="{% url 'logout' %}">Log out</a></li>
                        {% endif %} 
                    </ul>

...

```
3. Ecommerce/settings.py
```
...

LOGOUT_REDIRECT_URL = '/' <-- 加入 Logout URL

...

```
---
## login 功能
1.   Ecommerce/urls.py
login_old會不用
```
...
path('login/', views.LoginView.as_view(template_name='core/login.html'), name='login'), <--
改掉，用views 裹的login 
...
```
2. core/templates/core/login.html
```

        <form method="post" action="." class="space-y-3">
            {% csrf_token %} <-- 加入csrf_token
            <div>
                <label>用戶</label>
                <input type="text" name="username" class="w-full mt-2 py-4 px-6 bg-white rounded-xl">
            </div><--用username 


            <div>
                <label>密碼</label>
                <input type="password" name="password" class="w-full mt-2 py-4 px-6 bg-white rounded-xl"> <--加name
            </div>
            {% if form.errors %} <-- error 判斷
                {% for field in form %}
                    {% for error in field.errors %}
                        <div class="p-6 bg-red-200 text-red-800 rounded-xl">
                            <p>{{ error|escape }}</p>
                        </div>
                    {% endfor %}
                {% endfor %}

                {% for error in form.non_field_errors %}
                    <div class="p-6 bg-red-200 text-red-800 rounded-xl">
                        <p>{{ error|escape }}</p>
                    </div>
                {% endfor %}
            {% endif %}


```
3. Ecommerce/settings.py
```
LOGOUT_REDIRECT_URL = '/'
LOGIN_REDIRECT_URL = '/' <--加入 login URl
```
---
指南（十一）-- 2099
===
要做的事： 
-建立購物頁面  
-建立checkout頁面  

---
## 建立購物頁面
1. cart/views.py
```
...

def cart(request):
    return render(request, 'cart/cart.html')
    //新建一個function 是 宣染 cart.html

```
2. Ecommerce/urls.py
```
...
from cart.views import add_to_cart, cart //加入cart function
...

path('cart/', cart, name='cart'), // 加入cart api/url
...

```

3. 在cart/templates/cart 建立cart.html  
cart.html
```
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto flex flex-wrap items-start py-6 px-6 xl:px-0">
    <div class="products w-full lg:w-3/4">
        <div class="product mb-6 flex pr-6">
            <a href="#" class="w-1/4">
                <img class="hover:shadow-lg rounded-xl" src="1.jpg">
            </a>

            <div class="w-3/4 pl-6">
                <div class="flex justify-between">
                    <a href="#" class="text-lg">Product name</a>

                    <span class="mb-6 pt-1 text-gray-400">$9.99</span>
                </div>

                <hr>

                <div class="quantity mt-6 flex items-center space-x-4">
                    <a href="#" class="p-3 bg-gray-100">-</a>
                    <span>2</span>
                    <a href="#" class="p-3 bg-gray-100">+</a>
                </div>
            </div>
        </div>

        <div class="product mb-6 flex pr-6">
            <a href="#" class="w-1/4">
                <img class="hover:shadow-lg rounded-xl" src="1.jpg">
            </a>

            <div class="w-3/4 pl-6">
                <div class="flex justify-between">
                    <a href="#" class="text-lg">Product name</a>

                    <span class="mb-6 pt-1 text-gray-400">$9.99</span>
                </div>

                <hr>

                <div class="quantity mt-6 flex items-center space-x-4">
                    <a href="#" class="p-3 bg-gray-100">-</a>
                    <span>2</span>
                    <a href="#" class="p-3 bg-gray-100">+</a>
                </div>
            </div>
        </div>
    </div>

    <div class="summary w-full w-1/4 p-6 bg-gray-100 rounded-xl mt-3">
        <h2 class="uppercase text-lg mb-5">Summary</h2>

        <div class="mb-6 flex justify-between">
            <span class="font-semibold">Total</span>
            <span>$99</span>
        </div>

        <a href="#" class="inline-block px-8 py-4 rounded-xl bg-purple-500 hover:bg-purple-700 text-white">Checkout</a>
    </div>
</div>
{% endblock %}

```

---
## 建立checkout頁面
1. cart/views.py
```
...

def checkout(request):
    return render(request, 'cart/checkout.html')

```

2. Ecommerce/urls.py
```
...

from cart.views import add_to_cart , cart , checkout //加入checkout
...

    path('cart/checkout/', checkout, name='checkout'), //加入checkout api/url

...

```
3. 在cart/templates/cart 建立checkout.html  
checkout.html
```
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto flex flex-wrap items-start py-6 px-6 xl:px-0">
    <div class="products w-full lg:w-3/4">
        <h1 class="mb-5 text-3xl">Checkout</h1>

        <div class="w-full pr-6">
            <div class="mb-6 p-6 bg-gray-100 rounded-xl">
                <h2 class="mb-5 uppercase text-lg">Shipping information</h2>

                <div class="flex space-x-6">
                    <div class="w-1/2 mb-4">
                        <label class="inline-block mb-2">First name</label>
                        <input type="text" class="w-full p-5 rounded-xl">
                    </div>

                    <div class="w-1/2 mb-4">
                        <label class="inline-block mb-2">Last name</label>
                        <input type="text" class="w-full p-5 rounded-xl">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="inline-block mb-2">Address</label>
                    <input type="text" class="w-full p-5 rounded-xl">
                </div>

                <div class="flex space-x-6">
                    <div class="w-1/2 mb-4">
                        <label class="inline-block mb-2">Zip code</label>
                        <input type="text" class="w-full p-5 rounded-xl">
                    </div>

                    <div class="w-1/2 mb-4">
                        <label class="inline-block mb-2">City/Place</label>
                        <input type="text" class="w-full p-5 rounded-xl">
                    </div>
                </div>
            </div>

            <div class="mb-6 p-6 bg-gray-100 rounded-xl">
                <h2 class="mb-5 uppercase text-lg">Contact information</h2>

                <div class="mb-4">
                    <label class="inline-block mb-2">Email</label>
                    <input type="email" class="w-full p-5 rounded-xl">
                </div>

                <div class="mb-4">
                    <label class="inline-block mb-2">Phone</label>
                    <input type="phone" class="w-full p-5 rounded-xl">
                </div>
            </div>

            <div class="mb-6 p-6 bg-gray-100 rounded-xl">
                <h2 class="mb-5 uppercase text-lg">Payment information</h2>
            </div>
        </div>
    </div>

    <div class="summary w-full w-1/4 p-6 bg-gray-100 rounded-xl mt-3">
        <h2 class="uppercase text-lg mb-5">Summary</h2>

        <div class="mb-6 flex justify-between">
            <span class="font-semibold">Total</span>
            <span>$99</span>
        </div>

        <a href="#" class="inline-block px-8 py-4 rounded-xl bg-purple-500 hover:bg-purple-700 text-white">Confirm checkout</a>
    </div>
</div>
{% endblock %}
```
---
指南（十二）-- 2297
===
要做的事：  
-Refactoring(重構)和解決一些問題

---
## Refactoring(重構)
1. Ecommerce/urls.py
```
from django.conf import settings
from django.conf.urls.static import static
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('', include('core.urls')),
    path('cart/', include('cart.urls')),
    path('admin/', admin.site.urls),
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```
2. 在App cart 創建urls.py
```
from django.urls import path

from cart.views import add_to_cart, cart, checkout

urlpatterns = [
    path('', cart, name='cart'),
    path('checkout/', checkout, name='checkout'),
    path('add_to_cart/<int:product_id>/', add_to_cart, name='add_to_cart'),
]
```
3. 在App core 創建urls.py
```
from django.contrib.auth import views
from django.urls import path

from core.views import frontpage, shop, signup
from product.views import product

urlpatterns = [
    path('', frontpage, name='frontpage'),
    path('signup/', signup, name='signup'),
    path('logout/', views.LogoutView.as_view(), name='logout'),
    path('login/', views.LoginView.as_view(template_name='core/login.html'), name='login'),
    path('shop/', shop, name='shop'),
    path('shop/<slug:slug>/', product, name='product'),
]

```
---
## 解決一些問題
在navbar的login  
在browser裹顥示title
1. core/templates/core/base.html
``` 
                    <head>
                     <title>{% block title %}{% endblock %} | Ecommerce</title>
                     </head>
                    ...
                    <a href="{% url 'frontpage' %}" class="py-4 text-lg text-purple-500 font-semibold">Ecommerce</a> //page改了frontpage
                    ...

                        <a href="{% url 'login' %}"> //# 改了{% url 'login' %}
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </a>
```
2. core/templatescore/core/frontpage.html
```
{% extends 'core/base.html' %}

{% block title %}Welcome{% endblock %}

{% block content %}
...

```
3. core/templates/core/login.html
```
{% extends 'core/base.html' %}

{% block title %}login{% endblock %}

{% block content %}
...

```
4. core/templates/core/shop.html
```
{% extends 'core/base.html' %}

{% block title %}Shop{% endblock %}

{% block content %}
...
```
5. core/templates/core/signup.html
```
{% extends 'core/base.html' %}

{% block title %}Sign up{% endblock %}

{% block content %}
...
```
6. cart/templates/cart/cart.html
```
{% extends 'core/base.html' %}

{% block title %}Cart{% endblock %}

{% block content %}
```
7. cart/templates/cart/checkout.html
```
{% extends 'core/base.html' %}

{% block title %}CheckOut{% endblock %}

{% block content %}

```
8. cart/templates/cart/menu_cart.html
```
<a href="{% url 'cart' %}" id="menu-cart-button" class="relative"> //#改成了{% url 'cart' %}
...

```
9. product/templates/product/partials/product_list_item.html
```
...

        <a 
        href="#"   <-- 改為#
        hx-get="{% url 'add_to_cart' product.id %}"  <--加入了HTMX
        hx-target="#menu-cart-button" <--加入了HTMX
        hx-swap="outerHTML"     <--加入了HTMX
        class="text-purple-500 hover:text-purple-800">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
            </svg>
        </a>

...
```
10 .product/templates/product/product.html
```
{% extends 'core/base.html' %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto flex flex-wrap py-6 px-6 xl:px-0">
    <div class="images w-full mb-6 lg:mb-0 lg:w-3/5">
        <img 
            class="rounded-xl" 
            src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/240x240x.jpg{% endif %}"
        > // img 改了 
        //意思是如DB裹有圖用 DB的圖 沒圖用 https://via.placeholder.com/240x240x.jpg 或自定的圖
    </div>
    ...
```
---
指南（十三）-- 2463
===
要做的事：  

-在購物車裹顥示正確商品  
-在購物車裹顥示總價錢  
-在結算裹顥示總價錢  
-只可以用戶才可以結算  
-在結算畫面顥示用戶資料  
-在購物車裹改變結算連結  

---
## 在購物車裹顥示正確商品 
1. cart/cart.py
```
...

    def __iter__(self):
        for p in self.cart.keys():
            self.cart[str(p)]['product'] = Product.objects.get(pk=p)

        for item in self.cart.values(): //在session 拿cart 裹的values
            item['total_price'] = int(item['product'].price * item['quantity']) / 100 
            //定義total_price

            yield item
        //不這樣打會說typeErrer:iter() returned non-iterator of type 'NoneType'
    

...

```
2. cart/templates/cart/cart.html  
刪除剩一個商品
```
<div class="max-w-6xl mx-auto flex flex-wrap items-start py-6 px-6 xl:px-0">
    <div class="products w-full lg:w-3/4">
        {% for item in cart %} // for loop cart  用item 作 參數?
 
        <div class="product mb-6 flex pr-6">
                            <a href="#" class="w-1/4">
                    <img class="hover:shadow-lg rounded-xl" src="{{ item.product.get_thumbnail }} "> // 不再是硬曲 用了 cart 的圖
                </a>

            <div class="w-3/4 pl-6">



                <div class="flex justify-between">
                    <a href="#" class="text-lg">{{ item.product.name }}</a>
    // 不再是硬曲 用了 cart 的name
                    <span class="mb-6 pt-1 text-gray-400">${{ item.total_price }}</span>
                    // 不再是硬曲 用了 cart 的total_price
                    
                </div>

                <hr>

                <div class="quantity mt-6 flex items-center space-x-4">
                    <a href="#" class="p-3 bg-gray-100">-</a>
                    <span>{{ item.quantity }}</span>
                    // 不再是硬曲 用了 cart 的運算結果
                    <a href="#" class="p-3 bg-gray-100">+</a>
                </div>
            </div>

     
        </div>

        {% endfor %}
    </div>

```
---
## 在購物車裹顥示總價錢 
1. cart/cart.py  
```
...

    def get_total_cost(self):  // 加入 這個function 
        return sum(item['total_price'] for item in self.cart.values())
```
2. cart/templates/cart/cart.html
```
...

        <div class="mb-6 flex justify-between">
            <span class="font-semibold">Total</span>
            <span>${{ cart.get_total_cost }}</span> 
            //改了 {{ cart.get_total_cost }}
        </div>
...

```
---
## 只可以用戶才可以結算 和 在結算裹顥示總價錢
1. cart/views.py
```
from django.contrib.auth.decorators import login_required //引入 DJango內置login
...


@login_required //加入 login decorator
def checkout(request):
    return render(request, 'cart/checkout.html')

```
2. Ecommerce/settings.py
```
...

LOGOUT_REDIRECT_URL = '/'
LOGIN_REDIRECT_URL = '/'
LOGIN_URL = '/login/' //加入login url

...

```

3. cart/templates/cart/checkout.html  
```

...

       <div class="mb-4">
                    <label class="inline-block mb-2">Email</label>
                    <input type="email" class="w-full p-5 rounded-xl" value="{{ request.user.email }}"> 
                    //value值用了db 裹的user的email
                </div>
...

        <div class="mb-6 flex justify-between">
            <span class="font-semibold">Total</span>
            <span>${{ cart.get_total_cost }}</span>
             //改了{{ cart.get_total_cost }}
        </div>
    ...

```
4. cart/cart.py
```
...

    def get_total_cost(self):
        for p in self.cart.keys():
            self.cart[str(p)]['product'] = Product.objects.get(pk=p)

        return int(sum(item['producdef myaccount(request):
    return render(request, 'core/myaccount.html')t'].price * item['quantity'] for item in self.cart.values())) / 100

```
---
## 在購物車裹改變結算連結
1. cart/templates/cart/cart.html
```
...
        <a href="{% url 'checkout' %}" class="inline-block px-8 py-4 rounded-xl bg-purple-500 hover:bg-purple-700 text-white">checkout</a> //改了# 變{% url 'checkout' %}

```
---
指南（十四）-- 2623
===
要做的事：  
-建立我的帳號頁面  
-加入我的帳號的連結  
-修改我的帳號頁面  
-修改我的帳號功能  

---
## 建立我的帳號頁面 
1. core/views.py
```
from django.contrib.auth.decorators import login_required //引入django login
...
@login_required // login decorators
def myaccount(request):
    return render(request, 'core/myaccount.html')
...
```
2. core/urls.py
```
from core.views import frontpage, shop, signup, myaccount // 加入myaccount
...

urlpatterns = [
    ...
    path('myaccount/', myaccount, name='myaccount'), 
    //myaccount api/url
    ...
]

...
```
3. 在core/templates/core裹新建myaccount.html  
myaccount.html
```
{% extends 'core/base.html' %}

{% block title %}My account{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-6">
    <h1 class="mb-5 text-3xl">My account</h1>

    <div class="mb-6">
       
        <strong>Username: </strong>{{ request.user.username }}<br>
        <strong>E-mail: </strong>{{ request.user.email }}<br>

        <a href="#" class="inline-block mt-4 py-4 px-6 rounded-xl text-white bg-purple-500">Edit</a>
    </div>

    <hr>

    <h2 class="my-6 text-xl">My orders</h2>

    <div class="w-full mb-6 p-6 flex flex-wrap bg-gray-100 rounded-xl">
        <div class="mb-6 flex justify-between">
            <a href="#">Order id: 1</a>
        </div>

        <div class="mb-6 w-full">
            <div class="product mb-6 flex pr-6">
                <a href="#" class="w-1/4">
                    <img class="hover:shadow-lg rounded-xl" src="1.jpg">
                </a>

                <div class="w-3/4 pl-6">
                    <div class="flex justify-between">
                        <a href="#" class="text-lg">Product name</a>

                        <p class="mb-6 pt-1 text-gray-400">$9.99</p>
                    </div>

                    <hr>

                    <div class="mt-6">
                        Quantity: 1
                    </div>
                </div>
            </div>

            <div class="product mb-6 flex pr-6">
                <a href="#" class="w-1/4">
                    <img class="hover:shadow-lg rounded-xl" src="1.jpg">
                </a>

                <div class="w-3/4 pl-6">
                    <div class="flex justify-between">
                        <a href="#" class="text-lg">Product name</a>

                        <p class="mb-6 pt-1 text-gray-400">$9.99</p>
                    </div>

                    <hr>

                    <div class="mt-6">
                        Quantity: 1
                    </div>
                </div>
            </div>

            <div class="product mb-6 flex pr-6">
                <a href="#" class="w-1/4">
                    <img class="hover:shadow-lg rounded-xl" src="1.jpg">
                </a>

                <div class="w-3/4 pl-6">
                    <div class="flex justify-between">
                        <a href="#" class="text-lg">Product name</a>

                        <p class="mb-6 pt-1 text-gray-400">$9.99</p>
                    </div>

                    <hr>

                    <div class="mt-6">
                        Quantity: 1
                    </div>
                </div>
            </div>
        </div>

        <div>
            <p class="text-lg">Date: 04.04.2022</p>
            <p class="text-lg">Total: $199</p>
        </div>
    </div>
</div>
{% endblock %}
```
---
## 加入我的帳號的連結 
1. core/templates/core
```
...
                <div class="menu-right flex items-center space-x-4">
                    <a href="{% url 'myaccount' %}"> //換成 {% url 'myaccount' %}
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </a>

                    {% include 'cart/menu_cart.html' %}
                </div>
            </div>
        </nav>
        {% block content %}
        {% endblock %}
...

```
---
## 修改我的帳號頁面
1. core/views.py
```
...

@login_required
def edit_myaccount(request):
    return render(request, 'core/edit_myaccount.html')
    ...
```
2. core/urls.py
```
...
from core.views import frontpage, shop, signup, myaccount, edit_myaccount //加入edit_myaccount
...
urlpatterns = [
...
path('myaccount/edit/', edit_myaccount, name='edit_myaccount'),
...
]
```
3. 在core/templates/core新開edit_myaccount.html  
edit_myaccount.html
```
{% extends 'core/base.html' %}

{% block title %}Edit account{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-6">
    <h1 class="mb-5 text-3xl">Edit account</h1>

    <form method="post" action="." class="space-y-3">
        {% csrf_token %}
        
        <div>
            <label>Username</label>
            <input name="username" value="{{ request.user.username }}" type="text" class="w-full mt-2 py-4 px-6 bg-gray-100 rounded-xl">
        </div>

        <div>
            <label>E-mail</label>
            <input name="email" value="{{ request.user.email }}" type="email" class="w-full mt-2 py-4 px-6 bg-gray-100 rounded-xl">
        </div>

        <div>
            <button class="py-4 px-6 rounded-xl text-white bg-purple-500">Submit</button>
        </div>
    </form>
</div>
{% endblock %}
```
4. core/templates/core/myaccount.html  
```
...
        <a href="{% url 'edit_myaccount' %}" class="inline-block mt-4 py-4 px-6 rounded-xl text-white bg-purple-500">Edit</a>
        //把# 改{% url 'edit_myaccount' %}
...
```
---
## 修改我的帳號功能 
1. core/views.py
```
...
@login_required
def edit_myaccount(request):
    if request.method == 'POST':
        user = request.user
        user.first_name = request.POST.get('first_name')
        user.last_name = request.POST.get('last_name')
        user.email = request.POST.get('email')
        user.username = request.POST.get('username')
        user.save()

        return redirect('myaccount')
    return render(request, 'core/edit_myaccount.html')
...
```
---
指南（十五）-- 2859
===
要做的事：  
- 把cart item html 放進 partials  
- menu cart 加入 htmx 屬性 和  menu cart/ update cart 創立view 和 url
- 把cart buttons 加入htmx 屬性  
- 更新 total price  
---
##  把cart item html 放進 partials 
1. 在cart/templates/cart裹，建立一個partials資料夾  
partials裹 建立 cart_item.html  
cart_item.html
```
<div class="product mb-6 flex pr-6">
    <a href="#" class="w-1/4">
        <img class="hover:shadow-lg rounded-xl" src="{{ item.product.get_thumbnail }}">
    </a>

    <div class="w-3/4 pl-6">
        <div class="flex justify-between">
            <a href="#" class="text-lg">{{ item.product.name }}</a>

            <span class="mb-6 pt-1 text-gray-400">${{ item.total_price }}</span>
        </div>

        <hr>

        <div class="quantity mt-6 flex items-center space-x-4">
            <a 
                class="p-3 bg-gray-100">
                -
            </a>
            <span>{{ item.quantity }}</span>
            <a 
                class="p-3 bg-gray-100">
                +
            </a>
        </div>
    </div>
</div>
```
2. cart/templates/cart/cart.html
```
        ...
        {% for item in cart %}
            {% include 'cart/partials/cart_item.html' %} // 導入partials裹的cart_item.html
        {% endfor %}
        ...
```
---
## menu cart 加入 htmx 屬性  和  menu cart/ update cart 創立view 和 url
1. core/templates/core/base.html
```
...
                    <div
                        hx-get="{% url 'hx_menu_cart' %}"
                        hx-trigger="update-menu-cart from:body"
                        hx-swap="innerHTML"
                    >
                        {% include 'cart/menu_cart.html' %}
                    </div> //加入htmx 屬性
...


```
2. cart/views.py
```
...
def hx_menu_cart(request): //給htmx 用
    return render(request, 'cart/menu_cart.html')

```

3. cart/urls.py
```
...
from cart.views import add_to_cart, cart, checkout, hx_menu_cart //加入hx_menu_cart function

...
urlpatterns = [
    path('', cart, name='cart'),
    path('checkout/', checkout, name='checkout'),
    path('add_to_cart/<int:product_id>/', add_to_cart, name='add_to_cart'),
    path('update_cart/<int:product_id>/<str:action>/', update_cart, name='update_cart'),
    path('hx_menu_cart/', hx_menu_cart, name='hx_menu_cart'), //加入了hx_menu_cart api/url
]


```
4. cart/views.py
```
...
from product.models import Product  //引入product 模組
...
def update_cart(request, product_id, action): //創立update_cart
    cart = Cart(request)

    // 商品+ -
    if action == 'increment':
        cart.add(product_id, 1, True)
    else:
        cart.add(product_id, -1, True) 
    
    product = Product.objects.get(pk=product_id)
    quantity = cart.get_item(product_id)['quantity']
    // 用 item obj 存已+ -了數量的商品
    item = {
        'product': {
            'id': product.id,
            'name': product.name,
            'image': product.image,
            'get_thumbnail': product.get_thumbnail(),
            'price': product.price,
        },
        'total_price': (quantity * product.price) / 100,
        'quantity': quantity,
    }
    // 走向'cart/partials/cart_item.html'時 ， htmx一起更新
    response = render(request, 'cart/partials/cart_item.html', {'item': item})
    response['HX-Trigger'] = 'update-menu-cart'

    return response

...
```
5. cart/cart.py
```
...

    //加入 get_item function 
    def get_item(self, product_id): 
         if str(product_id) in self.cart:   !!為何要加str??
        //在session 找 product
            return self.cart[str(product_id)]
        else:
            return None

```
---
## 把cart buttons 加入htmx 屬性
1. cart/templates/cart/partials/cart_item.html
```
<div class="product mb-6 flex pr-6" id="cart-item-{{ item.product.id }}"> //加了id
    <a href="#" class="w-1/4">
    ...
            <a 
                class="p-3 bg-gray-100"
                hx-get="{% url 'update_cart' item.product.id 'decrement' %}"
                hx-target="#cart-item-{{ item.product.id }}"
                hx-swap="outerHTML"
            > //加入了 htmx 
                -
            </a>
            <span>{{ item.quantity }}</span>
            <a 
                class="p-3 bg-gray-100"
                hx-get="{% url 'update_cart' item.product.id 'increment' %}"
                hx-target="#cart-item-{{ item.product.id }}"
                hx-swap="outerHTML"
            >//加入了 htmx 
                +
            </a>

    ...
```
2. cart/urls.py
```
...
from cart.views import add_to_cart, cart, checkout, hx_menu_cart, update_cart
// 加多 update_cart function 

urlpatterns = [
...
    path('update_cart/<int:product_id>/<str:action>/', update_cart, name='update_cart'),//多了update_cart api/url
    path('hx_menu_cart/', hx_menu_cart, name='hx_menu_cart'),
...
]


```
---
## 更新 total price 
1. 在cart/tamplates/cart/partials創建cart_total.html  
cart_total.html

```
${{ cart.get_total_cost }}

```
2. cart/views.py
```
...
def hx_cart_total(request):
    return render(request, 'cart/partials/cart_total.html')
```
3. cart/urls.py  
```
...
from cart.views import add_to_cart, cart, checkout, hx_menu_cart, update_cart, hx_cart_total //加入hx_cart_total
...

urlpatterns = [
    ...
    path('hx_cart_total/', hx_cart_total, name='hx_cart_total'), 
    //加入hx_cart_total api / url
]
```
4. cart/templates/cart/cart.html  
```
...
            <span
                hx-get="{% url 'hx_cart_total' %}"
                hx-trigger="update-menu-cart from:body"
                hx-swap="innerHTML"
            > //加了 htmx 
                {% include 'cart/partials/cart_total.html' %} //因為放了partials 所以在partials拿出來
            </span>
...

```
---
指南（十六）-- 3081
===
要做的事：
- 建立App orders  
- 在App orders 建立 database  
- 建立 checkout 的 views 和 url  
- 把orders list 放在當前用戶  
---
## 建立App orders  
1. 在終端機裹
```
python manage.py startapp orders
```
2.  Ecommerce/settings.py
```

...
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'cart',
    'core',
    'product',
    'orders', //加入orders
]
...

```
---
## 在App orders 建立 database
1. orders/models.py
```
from itertools import product
from django.contrib.auth.models import User
from django.db import models

from product.models import Product

class Order(models.Model):
    ORDERED = 'ordered'
    SHIPPED = 'shipped'

//用於status
    STATUS_CHOICES = (
        (ORDERED, 'Ordered'),
        (SHIPPED, 'Shipped')
    )
// order model 
    user = models.ForeignKey(User, related_name='orders', 
    //連上user model 
    blank=True, null=True, on_delete=models.CASCADE)
    first_name = models.CharField(max_length=255)
    last_name = models.CharField(max_length=255)
    email = models.CharField(max_length=255)
    address = models.CharField(max_length=255)
    zipcode = models.CharField(max_length=255)
    place = models.CharField(max_length=255)
    phone = models.CharField(max_length=255)

    created_at = models.DateTimeField(auto_now_add=True)

    paid = models.BooleanField(default=False)
   把orders list 放在當前用戶 paid_amount = models.IntegerField(blank=True, null=True)

    // status 
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default=ORDERED)

// orderItem連上 Order , Product model
class OrderItem(models.Model):
    order = models.ForeignKey(Order, related_name='items', on_delete=models.CASCADE)
    product = models.ForeignKey(Product, related_name='items', on_delete=models.CASCADE)
    price = models.IntegerField()
    quantity = models.IntegerField(default=1)
```
2. 在終端機
```
python manage.py makemigrations
python manage.py migrate
```
---
## 建立 checkout 的 views 和 url 
1. orders/views.py
```
from django.shortcuts import render, redirect

from cart.cart import Cart

from .models import Order, OrderItem

def start_order(request):
    cart = Cart(request)

    if request.method == 'POST':
        first_name = request.POST.get('first_name')
        last_name = request.POST.get('last_name')
        email = request.POST.get('email')
        address = request.POST.get('address')
        zipcode = request.POST.get('zipcode')
        place = request.POST.get('place')
        phone = request.POST.get('phone')

        order = Order.objects.create(user=request.user, first_name=first_name, last_name=last_name, email=email, phone=phone, address=address, zipcode=zipcode, place=place)

        for item in cart:
            product = item['product']
            quantity = int(item['quantity'])
            price = product.price * quantity

            item = OrderItem.objects.create(order=order, product=product, price=price, quantity=quantity)

        return redirect('myaccount')
    return redirect('cart')
```
2. orders/urls.py
```
from django.urls import path

from .views import start_order

urlpatterns = [
    path('start_order/', start_order, name='start_order'),
]
```
3. cart/templates/cart/checkout.html  
```
...
    <form method="post" action="{% url 'start_order' %}"> //加入form method action
        {% csrf_token %}  // 加入csrf_token
        <div class="products w-full lg:w-3/4">
            <h1 class="mb-5 text-3xl">Checkout</h1>

            <div class="w-full pr-6">
                <div class="mb-6 p-6 bg-gray-100 rounded-xl">
                    <h2 class="mb-5 uppercase text-lg">Shipping information</h2>

                    <div class="flex space-x-6">
                        <div class="w-1/2 mb-4">
                            <label class="inline-block mb-2">First name</label>
                            <input name="first_name" type="text" class="w-full p-5 rounded-xl" value="{{ request.user.first_name }}">//加入 name
                        </div> 

                        <div class="w-1/2 mb-4">
                            <label class="inline-block mb-2">Last name</label>
                            <input name="last_name" type="text" class="w-full p-5 rounded-xl" value="{{ request.user.last_name }}">//加入 name
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="inline-block mb-2">Address</label>
                        <input name="address" type="text" class="w-full p-5 rounded-xl">//加入 name
                    </div>

                    <div class="flex space-x-6">
                        <div class="w-1/2 mb-4">
                            <label class="inline-block mb-2">Zip code</label>
                            <input name="zipcode" type="text" class="w-full p-5 rounded-xl">//加入 name
                        </div>

                        <div class="w-1/2 mb-4">
                            <label class="inline-block mb-2">City/Place</label>
                            <input name="place" type="text" class="w-full p-5 rounded-xl">//加入 name
                        </div>
                    </div>
                </div>

                <div class="mb-6 p-6 bg-gray-100 rounded-xl">
                    <h2 class="mb-5 uppercase text-lg">Contact information</h2>

                    <div class="mb-4">
                        <label class="inline-block mb-2">Email</label>
                        <input name="email" type="email" class="w-full p-5 rounded-xl" value="{{ request.user.email }}"> //加入 name
                    </div>

                    <div class="mb-4">
                        <label class="inline-block mb-2">Phone</label>
                        <input name="phone" type="phone" class="w-full p-5 rounded-xl">//加入 name
                    </div>
                </div>

                <div class="mb-6 p-6 bg-gray-100 rounded-xl">
                    <h2 class="mb-5 uppercase text-lg">Payment information</h2>
                </div>
            </div>
        </div>

        <div class="summary w-full w-1/4 p-6 bg-gray-100 rounded-xl mt-3">
            <h2 class="uppercase text-lg mb-5">Summary</h2>

            <div class="mb-6 flex justify-between">
                <span class="font-semibold">Total</span>
                <span>${{ cart.get_total_cost }}</span>
            </div>

            <button //a 轉 button
                class="inline-block px-8 py-4 rounded-xl bg-purple-500 hover:bg-purple-700 text-white"
            >
                Confirm checkout
            </button> //a 轉 button
        </div>
    </form> //加入 </form>收尾
</div>
{% endblock %}
```
4. Ecommerce/urls.py
```
...

    path('cart/', include('cart.urls')),
    path('order/', include('orders.urls')), //加入order api
    path('admin/', admin.site.urls),
...

```
---
## 把orders list 放在當前用戶
1. core/templates/core/myaccount.html
```
...
{% for order in request.user.orders.all %}  // 從db 裹抽取data用
        <div class="w-full mb-6 p-6 flex flex-wrap bg-gray-100 rounded-xl">
            <div class="mb-6 flex justify-between">
                <a href="#">Order id: {{ order.id }}</a> // 用db id
            </div>

            <div class="mb-6 w-full">
                {% for item in order.items.all %}
                    <div class="product mb-6 flex pr-6">
                        <a href="#" class="w-1/4">
                            <img class="hover:shadow-lg rounded-xl" src="{{ item.product.get_thumbnail }}"> // db item.img
                        </a>

                        <div class="w-3/4 pl-6">
                            <div class="flex justify-between">
                                <a href="#" class="text-lg">{{ item.product.name }}</a> // db item.name

                                <p class="mb-6 pt-1 text-gray-400">${{item.product.price}</p> // db item.price
                            </div>

                            <hr>

                            <div class="mt-6">
                                Quantity: {{ item.quantity }} //db item.quanity
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
...
        </div>
    {% endfor %}
</div>
{% endblock %}

```

---
指南（十七）-- 3341  
要做的事：
- debug(cart bug) 
- 安裝 設定 stripe  
- 把public key 放到 checkout 頁面 
- 建立checkout session  
- 與stripe 資料和 checkout form 資料認證  
---
##  debug(cart bug)  
1. cart/templates/cart/partials/cart_item.html
```
{% if item %}
...

{% endif %}

```
2. cart/views.py  
```
...
def update_cart(request, product_id, action):
    cart = Cart(request)

    if action == 'increment':
        cart.add(product_id, 1, True)
    else:
        cart.add(product_id, -1, True)
    
    product = Product.objects.get(pk=product_id)
    quantity = cart.get_item(product_id) //把原先的['quantity']拿走 因為定義不到INT

    if quantity: //判段 quantity 是否在cart 裹存在
        quantity = quantity['quantity']

        item = {
            'product': {
                'id': product.id,
                'name': product.name,
                'image': product.image,
                'get_thumbnail': product.get_thumbnail(),
                'price': product.price,
            },
            'total_price': (quantity * product.price) / 100,
            'quantity': quantity,
        } //有就入item 
    else:
        item = None  //沒有就None 值


...
```
---
## 安裝 設定 stripe
1. 在終端機  
```
pip install stripe
```
2. Ecommerce/settings.py
```
...
//在settings.py 裹設定steipe
STRIPE_API_KEY_PUBLISHABLE = '你STRIPE的public_key'
STRIPE_API_KEY_HIDDEN = '你STRIPE的hedden_key'
...

```
---
## 把public key 放到 checkout 頁面

1. cart/views.py
```
from django.conf import settings //引入settings
...
// 加入settings裹的stripe public_key
@login_required
def checkout(request):
    pub_key = settings.STRIPE_API_KEY_PUBLISHABLE 
    return render(request, 'cart/checkout.html', {'pub_key': pub_key}) //把pub_key 放在template 裹用

...
```
---
## 建立checkout session
1. orders/views.py
```
import json // 引入json 模組
import stripe //引入stripe 模組
from django.conf import settings //引入 settings
from django.http import JsonResponse // 引入JsonResponse 模組
...

def start_order(request):
    cart = Cart(request)
    //用於在stripe
    data = json.loads(request.body) //加入data
    total_price = 0 //總價 

    items = [] 

    for item in cart:
        product = item['product']
        total_price += product.price * int(item['quantity']) 計算總數

        //存放商品資料
        obj = {
            'price_data': {
                'currency': 'usd',
                'product_data': {
                    'name': product.name,
                },
                'unit_amount': product.price,
            },
            'quantity': item['quantity']
        }

        items.append(obj)

    // checkout session 建立
        stripe.api_key = settings.STRIPE_API_KEY_HIDDEN
    session = stripe.checkout.Session.create(
        payment_method_types=['card'], //比錢方法
        line_items=items, //指上面items
        mode='payment', //
        success_url='http://127.0.0.1:8000/cart/success/', //比左錢之後頁面
        cancel_url='http://127.0.0.1:8000/cart/' //唔比錢既頁面
    )
 payment_intent = session.payment_intent
 //用了request.data
    first_name = data['first_name']
    last_name = data['last_name']
    email = data['email']
    address = data['address']
    zipcode = data['zipcode']
    place = data['place']
    phone = data['phone']

    order = Order.objects.create(user=request.user, first_name=first_name, last_name=last_name, email=email, phone=phone, address=address, zipcode=zipcode, place=place)
    order.payment_intent = payment_intent //order的payment_intent拿了payment_intent的值
    order.paid_amount = total_price// order .paid_amount 拿了 total_price 的值
    order.paid = True
    order.save() //把上面的東西全save了

    for item in cart:
        product = item['product']
        quantity = int(item['quantity'])
        price = product.price * quantity

        item = OrderItem.objects.create(order=order, product=product, price=price, quantity=quantity)

    return JsonResponse({'session': session, 'order': payment_intent})// 直接用json傳頁面

```

---
## 與stripe 資料和 checkout form 資料認證 
1. core/templates/core/base.html
```
...
        <script src="https://unpkg.com/htmx.org@1.7.0"></script>
        {% block scripts %} //加入scripts
        {% endblock %}
    </body>
</html>

```
2. cart/templates/cart/checkout.html
```
...
</div>
{% endblock %}

{% block scripts %}
<script type="application/javascript" src="https://js.stripe.com/v3/"></script>
<script>
    function validateForm(data) {
        let errors = []

        if (data.first_name === '') {
            errors.push('First name is empty')
        }

        if (data.last_name === '') {
            errors.push('Last name is empty')
        }

        if (data.email === '') {
            errors.push('Email is empty')
        }

        if (data.phone === '') {
            errors.push('Phone is empty')
        }

        if (data.address === '') {
            errors.push('Address is empty')
        }

        if (data.zipcode === '') {
            errors.push('Zipcode is empty')
        }

        if (data.place === '') {
            errors.push('Place is empty')
        }

        return errors
    }

    function buy(event) {
        event.preventDefault()

        let data = {
            'first_name': document.querySelector('input[name=first_name]').value,
            'last_name': document.querySelector('input[name=last_name]').value,
            'email': document.querySelector('input[name=email]').value,
            'phone': document.querySelector('input[name=phone]').value,
            'address': document.querySelector('input[name=address]').value,
            'zipcode': document.querySelector('input[name=zipcode]').value,
            'place': document.querySelector('input[name=place]').value,
        }

        let errors = validateForm(data)

        if (errors.length) {
            console.log('Errors', errors)
        } else {
            var stripe = Stripe('{{ pub_key }}')

            fetch('/order/start_order/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                credentials: 'same-origin',
                body: JSON.stringify(data)
            })
            .then(function(response) {
                return response.json()
            })
            .then(function(session) {
                return stripe.redirectToCheckout({ sessionId: session.session.id })
            })
            .then(function(result) {
                if (result.error) {
                    alert(result.error.message)
                }
            })
            .catch(function(error) {
                console.log('Errors', error)
            })
        }

        return false
    }
</script>
{% endblock %}
```

---
指南（十八）-- 3608
===
要做的事：  
- 在checkout頁面出error  
- 改變order次序  
- 建立成功頁面  
- 清空cart  
- 在orders page 顯示正確價錢  
---
## 在checkout頁面出error
1. cart/templates/cart/checkout.html
```
...
                <div class="mb-4">
                    <label class="inline-block mb-2">Phone</label>
                    <input name="phone" type="phone" class="w-full p-5 rounded-xl">
                </div>
            </div>

            <div class="mb-6 p-6 bg-gray-100 rounded-xl" id="errors"> // 加入了id="errors"
            </div>
...

{% block scripts %}
<script type="application/javascript" src="https://js.stripe.com/v3/"></script>
<script>

let el = document.querySelector('#errors') //加入 document.querySelector('#errors')

    function validateForm(data) {
        let errors = []
...
        if (data.place === '') {
            errors.push('Place is empty')
        }

        if (errors.length > 0) { //加入 error list 是否有東西 有就出以下的html
            let html = '<ul>';
            
            errors.forEach((error) => {
                html += '<li>' + error + '</li>';
            })

            el.innerHTML = html + '</ul>';
        } else {
            el.innerHTML = ''; //沒有就html出空白
        }

        return errors
    }
    ...
```
---
## 改變order次序  
1.orders/models.py
```
...

    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default=ORDERED)

    class Meta: 
        ordering = ('-created_at',) //加入時序

    class OrderItem(models.Model):
    ...

```
---
##  建立成功頁面 
1. cart/views.py
```
...
def success(request):
    return render(request, 'cart/success.html') //加入 render success.html

...

```
2. cart/urls.py
```
...
from cart.views import add_to_cart, cart, checkout, hx_menu_cart, update_cart, hx_cart_total, success //加入success function

urlpatterns = [
...
path('success/', success, name='success'),
...
]

```
3. 在cart/templates/cart裹新建success.html
```
{% extends 'core/base.html' %}

{% block title %}Sucess{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto flex flex-wrap items-start py-6 px-6 xl:px-0">
    <div class="products w-full lg:w-3/4">
        <h1 class="mb-5 text-3xl">Success</h1>

        <p>Thanks for making the purchase!</p>
    </div>
</div>
{% endblock %}
```
---
## 清空cart 
1. cart/cart.py
```
...

    def clear(self):  //加入clear function 
        del self.session[settings.CART_SESSION_ID]
        self.session.modified = True
...
```
2. orders/views.py
```
    for item in cart:
            product = item['product']
            quantity = int(item['quantity'])
            price = product.price * quantity

            item = OrderItem.objects.create(order=order, product=product, price=price, quantity=quantity)

    cart.clear() //引入clear function

    return JsonResponse({'session': session, 'order': payment_intent})
```
---
## 在orders page 顯示正確價錢
1. core/templates/core/myaccount.html
```
...
                            <div class="flex justify-between">
                                <a href="#" class="text-lg">{{ item.product.name }}</a>

                                <p class="mb-6 pt-1 text-gray-400">${{ item.get_total_price }}</p> //改成 {{ item.get_total_price }}
                            </div>
                            ...
            <p class="text-lg">Date: {{ order.created_at }}</p>
            <p class="text-lg">Total: ${{ order.get_total_price }}</p>
            // 改成 {{ order.get_total_price }}
```
2. orders/models.py
```
...

    class Meta:
        ordering = ('-created_at',)
    
    def get_total_price(self): //加入get_total_price
        if self.paid_amount:
            return self.paid_amount / 100
        
        return 0


class OrderItem(models.Model):
    order = models.ForeignKey(Order, related_name='items', on_delete=models.CASCADE)
    product = models.ForeignKey(Product, related_name='items', on_delete=models.CASCADE)
    price = models.IntegerField()
    quantity = models.IntegerField(default=1)

    def get_total_price(self): //加入 get_total_price function
        return self.price / 100
```
---